
process MERGE  = {

  include "FWCore/MessageService/data/MessageLogger.cfi"
  replace MessageLogger.cerr.FwkReport.reportEvery = 1000
  replace MessageLogger.cerr.INFO.limit = 1000

  untracked  PSet options = {
    include "FWCore/Framework/test/cmsExceptionsFatalOption.cff"
  }

  source = PoolSource {
    untracked vstring fileNames = { "file:testRunMerge1.root",
                                    "file:testRunMerge2.root",
                                    "file:testRunMerge3.root" }
  }

  module thingWithMergeProducer = ThingWithMergeProducer { }

  module test = TestMergeResults {

#   These values below are just arbitrary and meaningless
#   We are checking to see that what we get out matches what
#   was put in.

#   expected values listed below come in sets of three
#      value expected in Thing
#      value expected in ThingWithMerge
#      value expected in ThingWithIsEqual
#   This set of 3 is repeated for each subsequent call to the function (eg beginRun)
#   The Prod suffix refers to objects from the process named PROD
#   The New suffix refers to objects created in the most recent process
#   When the sequence of parameter values is exhausted it stops checking

    untracked vint32 expectedBeginRunProd = { 10001, 10002, 10003,
                                              10001, 10002, 10003,
                                              10001, 30006, 10003 }

    untracked vint32 expectedEndRunProd = { 100001, 200004, 100003,
                                            100001, 100002, 100003,
                                            100001, 300006, 100003 }

    untracked vint32 expectedBeginLumiProd = { 101, 102, 103,
                                               101, 102, 103,
                                               101, 306, 103 }

    untracked vint32 expectedEndLumiProd = { 1001, 2004, 1003,
                                             1001, 1002, 1003,
                                             1001, 3006, 1003 }



    untracked vint32 expectedBeginRunNew = { 10001, 10002, 10003,
                                             10001, 10002, 10003,
                                             10001, 20004, 10003 }


    untracked vint32 expectedEndRunNew = { 100001, 100002, 100003,
                                           100001, 100002, 100003,
                                           100001, 200004, 100003 }


    untracked vint32 expectedBeginLumiNew = { 101, 102, 103,
                                              101, 102, 103,
                                              101, 204, 103 }


    untracked vint32 expectedEndLumiNew = { 1001, 1002, 1003,
                                            1001, 1002, 1003,
                                            1001, 2004, 1003 }


    untracked int32 expectedRespondToOpenInputFile = 3
    untracked int32 expectedRespondToCloseInputFile = 3
    untracked int32 expectedRespondToOpenOutputFiles = 1
    untracked int32 expectedRespondToCloseOutputFiles = 1

    untracked vstring expectedInputFileNames = 
                                  { "file:testRunMerge1.root",
                                    "file:testRunMerge2.root",
                                    "file:testRunMerge3.root" }

    untracked bool verbose = false
  }

  module out = PoolOutputModule {
    untracked string fileName = "testRunMerge.root"

    untracked vstring outputCommands = {
      "keep *",
      "drop *_makeThingToBeDropped_*_*"
    }
  }

  path path1 = { thingWithMergeProducer & test }

  endpath e = { out }
}
