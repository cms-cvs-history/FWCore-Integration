

process PROD = {

  untracked PSet maxEvents = {untracked int32 input = 10}

  include "FWCore/MessageService/data/MessageLogger.cfi"
  replace MessageLogger.cerr.FwkReport.reportEvery = 1000
  replace MessageLogger.cerr.INFO.limit = 1000

  untracked  PSet options = {
    include "FWCore/Framework/test/cmsExceptionsFatalOption.cff"
  }

  source = EmptySource {
    untracked uint32 firstRun = 1
    untracked uint32 firstLuminosityBlock = 1
    untracked uint32 numberEventsInLuminosityBlock = 100
    untracked uint32 numberEventsInRun = 100
    untracked uint32 firstEvent = 1
  }

  module thingWithMergeProducer = ThingWithMergeProducer {
    untracked string labelToGet = "m1"
  }

# These are here only for tests of parentage merging
  module m1 = ThingWithMergeProducer { }
  module m2 = ThingWithMergeProducer { }
  module m3 = ThingWithMergeProducer { }

  module tryNoPut = ThingWithMergeProducer {
    untracked bool noPut = true
  }

  module makeThingToBeDropped = ThingWithMergeProducer { }

  module test = TestMergeResults {

#   These values below are just arbitrary and meaningless
#   We are checking to see that the value we get out matches what
#   was put in.

#   expected values listed below come in sets of three
#      value expected in Thing
#      value expected in ThingWithMerge
#      value expected in ThingWithIsEqual
#   This set of 3 is repeated below at each point it might change
#   The Prod suffix refers to objects from the process named PROD
#   The New suffix refers to objects created in the most recent process
#   When the sequence of parameter values is exhausted it stops checking
#   0's are just placeholders, if the value is a "0" the check is not made
#   and it indicates the product does not exist at that point.
#   *'s indicate lines where the checks are actually run by the test module.

    untracked vint32 expectedBeginRunProd = {     0,      0,      0,  # start
                                                  0,      0,      0,  # begin file
                                              10001,  10002,  10003,  # * begin run
                                              10001,  10002,  10003 } # end run

    untracked vint32 expectedEndRunProd = {       0,      0,      0,  # start
                                                  0,      0,      0,  # begin file
                                                  0,      0,      0,  # begin run  
                                             100001, 100002, 100003 } # * end run  

    untracked vint32 expectedBeginLumiProd = {    0,      0,      0,  # start
                                                  0,      0,      0,  # begin file
                                                101,    102,    103,  # * begin lumi
                                                101,    102,    103 } # end lumi

    untracked vint32 expectedEndLumiProd = {      0,      0,      0,  # start
                                                  0,      0,      0,  # begin file
                                                  0,      0,      0,  # begin lumi
                                               1001,   1002,   1003 } # * end lumi

    untracked vint32 expectedBeginRunNew = { }
    untracked vint32 expectedEndRunNew = { }
    untracked vint32 expectedBeginLumiNew = { }
    untracked vint32 expectedEndLumiNew = { }

    untracked vstring expectedParents = { "m1" }

    untracked bool verbose = false
  }

  path p = { m1 & m2 & m3 }
  path p1 = { thingWithMergeProducer & test }
  path p2 = { tryNoPut }
  path p3 = { makeThingToBeDropped }

  module out = PoolOutputModule {
    untracked string fileName = "testRunMerge1.root"
  }

  endpath e = { out }
}
